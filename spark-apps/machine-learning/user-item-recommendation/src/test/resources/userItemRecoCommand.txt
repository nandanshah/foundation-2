drop keyspace if exists fistest;
drop keyspace if exists n2test;
create keyspace if not exists fistest with replication = { 'class' : 'SimpleStrategy', 'replication_factor' : 1 };
create keyspace if not exists n2test with replication = { 'class' : 'SimpleStrategy', 'replication_factor' : 1 };
use n2test;
create table itemdocument (id uuid,tenantid uuid,regionid uuid,localeid uuid,credits_id uuid,datecreated text,duration int,episodecount int,fidelities list<text>,fullimg text,genres_id list<uuid>,largethumbnail text,licensing_id uuid,likecnt int,likedpct double,longdesc text,moods_id list<uuid>,permissions text,progress int,recommendationreason text,reviews_id list<uuid>,seasons_id list<uuid>,shortdesc text,thumbnail text,title text,trailerurl text,type_id uuid,userrating text,viewcnt int,year int,PRIMARY KEY (id));
create table account (id uuid,tenant_id uuid,type text,PRIMARY KEY (id));
create table profile (accountid uuid,id uuid,homeregionid uuid,preferredlocaleid uuid,avatarimageurl text,birthdate timestamp,defaultcolor text,emailaddress text,emailaddress_lower text,firstname text,gender text,isadmin boolean,isrootprofile boolean,lastname text,notfiyfriendregistration boolean,notifyfriendlike boolean,notifynewrelease boolean,notifypromotional boolean,notifywatchlistexpiration boolean,passwordhash text,passwordsalt text,pinhash text,pinsalt text,profiletype text,socialauthtoken text,watchlist_id uuid,PRIMARY KEY (accountid, id));
insert into profile(id,accountid,homeregionid,preferredlocaleid) values(C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1);
insert into account(id,tenant_id) values(C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1);
insert into account(id,tenant_id) values(C979CA35-B58D-434B-B2D6-EA0316BCC9A2,C979CA35-B58D-434B-B2D6-EA0316BCC9A2);
insert into itemdocument(id,tenantid,regionid,localeid) values(C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1);
insert into itemdocument(id,tenantid,regionid,localeid) values(C979CA35-B58D-434B-B2D6-EA0316BCC9A5,C979CA35-B58D-434B-B2D6-EA0316BCC9A5,C979CA35-B58D-434B-B2D6-EA0316BCC9A5,C979CA35-B58D-434B-B2D6-EA0316BCC9A1);
use fistest;
create table if not exists trend_reco(periodid timeuuid,tenantid uuid,regionid uuid,itemid uuid,trendscore double,normalizedtrendscore double,trendscorereason text,eventrequired int,date timestamp, primary key (periodid,tenantid,regionid,itemid));
create table if not exists popularity_reco(periodid timeuuid,tenantid uuid,regionid uuid,itemid uuid,popularityscore double,normalizedpopularityscore double,popularityscorereason text,eventrequired int,date timestamp,primary key (periodid,tenantid,regionid,itemid));
create table if not exists fnp_reco(periodid timeuuid,tenantid uuid,regionid uuid,itemid uuid,fnpscore double,normalizedfnpscore double,fnpscorereason text,eventrequired int,date timestamp, primary key (periodid,tenantid,regionid,itemid));
create table if not exists new_release_reco(periodid timeuuid,tenantid uuid,regionid uuid,itemid uuid,newreleasescore double,normalizednewreleasescore double,newreleasescorereason text,eventrequired int,date timestamp, primary key (periodid,tenantid,regionid,itemid));
create table if not exists user_item_score_summary (periodid timeuuid,tenantid uuid,regionid uuid,itemid uuid,trendscore double,trendscorereason text,popularityscore double,popularityscorereason text,fnpscore double,fnpscorereason text,newreleasescore double,newreleasescorereason text,eventrequired int,date timestamp,primary key (periodid,tenantid, regionid,itemid));
create table if not exists user_item_reco(periodid timeuuid,tenantid uuid,regionid uuid,profileid uuid,itemid uuid,trendscore double,trendscorereason text,popularityscore double,popularityscorereason text,fnpscore double,fnpscorereason text,newreleasescore double,newreleasescorereason text,socialscore double,socialscorereason text,recobyfoundationscore double,recobyfoundationreason text,eventrequired int,date timestamp,primary key (periodid,tenantid, regionid,profileid,itemid));
create table if not exists social_reco(periodid timeuuid, tenantid uuid,regionid uuid,itemid uuid, profileid uuid,socialscore double,socialscorereason text, eventrequired int,date timestamp,primary key (periodid,tenantid,regionid,itemid,profileid));
create table if not exists pio_user_reco ( tenantid uuid, regionid uuid, profileid uuid, itemid uuid ,lastrecofetched timestamp, recobyfoundationscore double,recobyfoundationreason text, eventrequired int,primary key(profileid,itemid));
create index index_trend_reco_date ON trend_reco (date);
create index index_trend_reco_event_required ON trend_reco (eventrequired);
create index popularity_reco_event_required ON popularity_reco (eventrequired);
create index popularity_reco_date ON popularity_reco (date);
create index index_fnp_reco_date ON fnp_reco (date);
create index index_fnp_reco_event_required ON fnp_reco (eventrequired);
create index index_new_release_reco_date ON new_release_reco (date);
create index index_new_release_reco_event_required ON new_release_reco (eventrequired);
create index social_reco_event_required ON social_reco (eventrequired);
create index social_reco_date ON social_reco (date);
create index user_item_score_summary_event_required ON user_item_score_summary (eventrequired);
create index user_item_score_summary_date ON user_item_score_summary (date);
create index pio_user_reco_event_required ON pio_user_reco (eventrequired);
create index pio_user_reco_date ON pio_user_reco (lastrecofetched);
insert into social_reco(periodid,tenantid,regionid,itemid,profileid,socialscore,socialscorereason,date,eventrequired) values(0a7f4400-02e0-11e4-8080-808080808080,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,0.6,'social','2014-06-30',1);
insert into trend_reco(periodid,tenantid,regionid,itemid,trendscore,normalizedtrendscore,trendscorereason,eventrequired,date) values(0a7f4400-02e0-11e4-8080-808080808080,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,4,0.6,'trending',1,'2014-06-30');
insert into popularity_reco(periodid,tenantid,regionid,itemid,popularityscore,normalizedpopularityscore,popularityscorereason,eventrequired,date) values(0a7f4400-02e0-11e4-8080-808080808080,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,4,0.6,'Popularity',1,'2014-06-30');
insert into fnp_reco(periodid,tenantid,regionid,itemid,fnpscore,normalizedfnpscore,fnpscorereason,eventrequired,date) values(0a7f4400-02e0-11e4-8080-808080808080,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,4,0.6,'fp',1,'2014-06-30');
insert into new_release_reco(periodid,tenantid,regionid,itemid,newreleasescore,normalizednewreleasescore,newreleasescorereason,eventrequired,date) values(0a7f4400-02e0-11e4-8080-808080808080,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,4,0.6,'new release',1,'2014-06-30');
insert into pio_user_reco(tenantid,regionid,profileid,itemid,lastrecofetched,recobyfoundationscore,recobyfoundationreason,eventrequired) values(C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,C979CA35-B58D-434B-B2D6-EA0316BCC9A1,'2014-06-30',0.6,'pio',1);
create table if not exists eo_spark_app_prop(sparkappname text, properties map<text,text>, primary key (sparkappname));
insert into eo_spark_app_prop(sparkappname,properties) values('useritemreco',{'input_date':'2014-06-30'});